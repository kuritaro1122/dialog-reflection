# NOTE: あくまでテスト用
# TODO JaSpacyReflectionTextBuilder に移植
from typing import Optional
import pytest


def detect_last_token(sent) -> Optional[str]:
    if len(sent) == 0:
        return None
    return sent[-1].text


@pytest.mark.parametrize(
    "msg, text, expected",
    [
        # ref, https://ja.wikipedia.org/wiki/五段活用
        (
            "五段活用",
            "あなたと歩く",
            "歩く",
        ),
        (
            "五段活用",
            "あなたと稼ぐ",
            "稼ぐ",
        ),
        (
            "五段活用",
            "あなたと話す",
            "話す",
        ),
        (
            "五段活用",
            "あなたと待つ",
            "待つ",
        ),
        (
            "五段活用",
            "あなたと死ぬ",
            "死ぬ",
        ),
        (
            "五段活用",
            "あなたと遊ぶ",
            "遊ぶ",
        ),
        (
            "五段活用",
            "本を読む",
            "読む",
        ),
        (
            "五段活用",
            "あなたと帰る",
            "帰る",
        ),
        (
            "五段活用",
            "あなたと買う",
            "買う",
        ),
        # ref, https://ja.wikipedia.org/wiki/上一段活用
        (
            "上一段活用",
            "あなたと老いる",
            "老いる",
        ),
        (
            "上一段活用",
            "あなたと居る",
            "居る",
        ),
        (
            "上一段活用",
            "あなたといる",
            "いる",
        ),
        (
            "上一段活用",
            "あなたと起きる",
            "起きる",
        ),
        (
            "上一段活用",
            "あなたと着る",
            "着る",
        ),
        (
            "上一段活用",
            "過ぎる",
            "過ぎる",
        ),
        (
            "上一段活用",
            "あなたと閉じる",
            "閉じる",
        ),
        (
            "上一段活用",
            "あなたと落ちる",
            "落ちる",
        ),
        (
            "上一段活用",
            "野菜を煮る",
            "煮る",
        ),
        (
            "上一段活用",
            "日差しを浴びる",
            "浴びる",
        ),
        (
            "上一段活用",
            "目に染みる",
            "染みる",
        ),
        (
            "上一段活用",
            "目を見る",
            "見る",
        ),
        (
            "上一段活用",
            "下に降りる",
            "降りる",
        ),
        # ref, https://ja.wikipedia.org/wiki/下一段活用
        (
            "下一段活用",
            "下に見える",
            "見える",
        ),
        (
            "下一段活用",
            "報酬を得る",
            "得る",
        ),
        (
            "下一段活用",
            "罰を受ける",
            "受ける",
        ),
        (
            "下一段活用",
            "宣告を告げる",
            "告げる",
        ),
        (
            "下一段活用",
            "映像を見せる",
            "見せる",
        ),
        (
            "下一段活用",
            "小麦粉を混ぜる",
            "混ぜる",
        ),
        (
            "下一段活用",
            "小麦粉を捨てる",
            "捨てる",
        ),
        (
            "下一段活用",
            "うどんを茹でる",
            "茹でる",
        ),
        (
            "下一段活用",
            "出汁が出る",
            "出る",
        ),
        (
            "下一段活用",
            "親戚を尋ねる",
            "尋ねる",
        ),
        (
            "下一段活用",
            "すぐに寝る",
            "寝る",
        ),
        (
            "下一段活用",
            "時を経る",
            "経る",
        ),
        (
            "下一段活用",
            "ご飯を食べる",
            "食べる",
        ),
        (
            "下一段活用",
            "ご飯を求める",
            "求める",
        ),
        (
            "下一段活用",
            "麺を入れる",
            "入れる",
        ),
        # ref. https://ja.wikipedia.org/wiki/カ行変格活用
        (
            "カ行変格活用",
            "家にくる",
            "くる",
        ),
        (
            "カ行変格活用",
            "家に来る",
            "来る",
        ),
        # ref. https://ja.wikipedia.org/wiki/サ行変格活用
        (
            "サ行変格活用",
            "軽くウォーキングする",
            "する",
        ),
        (
            "サ行変格活用",
            "フライパンを熱する",
            "熱する",
        ),
        (
            "サ行変格活用",
            "影響が生ずる",
            "生ずる",
        ),
        # 形容詞
        (
            "形容詞",
            "あなたは美しい",
            "美しい",
        ),
        # TODO 省略を実装したら直す
        # # 形容動詞
        # (
        #     "形容動詞",
        #     "あなたは傲慢だ",
        #     "傲慢",
        # ),
        # 名詞
        (
            "名詞",
            "それは明日",
            "明日",
        ),
        # 固有名詞
        (
            "固有名詞",
            "それはステファン",
            "ステファン",
        ),
        # 代名詞
        (
            "代名詞",
            "それはそれ",
            "それ",
        ),
    ],
)
def test_spacy_katsuyo_text_detector(nlp_ja, msg, text, expected):
    sent = next(nlp_ja(text).sents)
    result = detect_last_token(sent)
    assert result == expected, msg
